<!-- Filtre Pharmacie (Admin uniquement) -->
{% if current_user.role == 'admin' and pharmacies %}
<div class="form-group">
    <label for="pharmacy_filter" class="form-label">
        <i class="ni ni-shop"></i> Filtrer par Pharmacie
    </label>
    <select id="pharmacy_filter" name="pharmacy_id" class="form-control" onchange="applyPharmacyFilter()">
        <option value="all" {% if pharmacy_filter == 'all' %}selected{% endif %}>Toutes les Pharmacies</option>
        {% for pharmacy in pharmacies %}
        <option value="{{ pharmacy.id }}" {% if pharmacy_filter|string == pharmacy.id|string %}selected{% endif %}>
            {{ pharmacy.name }} {% if pharmacy.type == 'depot' %}(Dépôt){% endif %}
        </option>
        {% endfor %}
    </select>
</div>

<script>
function applyPharmacyFilter() {
    const select = document.getElementById('pharmacy_filter');
    const pharmacyId = select.value;
    
    // Construire l'URL avec le filtre pharmacie
    const url = new URL(window.location);
    url.searchParams.set('pharmacy_id', pharmacyId);
    url.searchParams.set('page', '1'); // Reset à la page 1
    
    window.location.href = url.toString();
}
</script>
{% endif %}

