{% extends "base.html" %}
{% block title %}Transfert Inter-Pharmacies{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-arrow-left-right"></i> Transfert Inter-Pharmacies</h2>
    <a href="{{ url_for('stock.index') }}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Retour</a>
</div>
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Nouveau Transfert</h5>
    </div>
    <div class="card-body">
        <form method="POST">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Pharmacie Source *</label>
                    <select class="form-control" name="from_pharmacy_id" id="from_pharmacy" required>
                        <option value="">Sélectionner...</option>
                        {% for pharmacy in pharmacies %}
                        <option value="{{ pharmacy.id }}">{{ pharmacy.name }} ({{ pharmacy.type }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Pharmacie Destination *</label>
                    <select class="form-control" name="to_pharmacy_id" id="to_pharmacy" required>
                        <option value="">Sélectionner...</option>
                        {% for pharmacy in pharmacies %}
                        <option value="{{ pharmacy.id }}">{{ pharmacy.name }} ({{ pharmacy.type }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-8 mb-3">
                    <label class="form-label">Produit *</label>
                    <select class="form-control" name="product_id" id="product_select" required>
                        <option value="">Sélectionner un produit...</option>
                        {% for product in products %}
                        <option value="{{ product.id }}" data-stock="{{ product.stock_quantity }}" data-pharmacy="{{ product.pharmacy_id }}">
                            {{ product.name }} - Stock: {{ product.stock_quantity }}
                            {% if product.pharmacy %}({{ product.pharmacy.name }}){% endif %}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Quantité *</label>
                    <input type="number" class="form-control" name="quantity" id="quantity" min="1" required>
                    <div class="form-text">Stock disponible: <span id="stock_display">-</span></div>
                </div>
                <div class="col-md-12 mb-3">
                    <label class="form-label">Notes</label>
                    <textarea class="form-control" name="notes" rows="3" placeholder="Raison du transfert, instructions, etc."></textarea>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-arrow-left-right"></i> Effectuer le Transfert
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('product_select').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    if (this.value) {
        const stock = selectedOption.dataset.stock;
        const pharmacyId = selectedOption.dataset.pharmacy;
        document.getElementById('stock_display').textContent = stock;
        document.getElementById('from_pharmacy').value = pharmacyId || '';
        document.getElementById('quantity').max = stock;
    } else {
        document.getElementById('stock_display').textContent = '-';
    }
});
</script>
{% endblock %}

