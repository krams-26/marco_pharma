<!--
=========================================================
* Argon Dashboard - Marco Pharma Edition
=========================================================
* Système de Gestion Pharmaceutique
* Basé sur Argon Dashboard de Creative Tim
=========================================================
-->
<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>
    {% block title %}MARCO PHARMA{% endblock %} | Gestion Pharmaceutique
  </title>

  <!-- Favicon - Multiple formats pour compatibilité -->
  <link rel="icon" href="/static/assets/img/brand/favicon.png" type="image/png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/assets/img/brand/favicon.png">
  
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="/static/assets/vendor/nucleo/css/nucleo.css" type="text/css">
  <link rel="stylesheet" href="/static/assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
  <!-- Argon CSS -->
  <link rel="stylesheet" href="/static/assets/css/argon.css?v=1.2.0" type="text/css">
  
  <!-- Custom Layout CSS -->
  <link rel="stylesheet" href="/static/css/custom-argon.css" type="text/css">
  <!-- Fix Icons CSS - Corrige les chemins des fonts d'icônes -->
  <link rel="stylesheet" href="/static/css/fix-icons.css" type="text/css">

  <!-- Specific CSS goes HERE -->
  {% block stylesheets %}{% endblock stylesheets %}

</head>

<body class="">

  {% if current_user.is_authenticated %}

  {% include "includes/sidenav.html" %}

  <div class="main-content" id="panel">

    {% include "includes/navigation.html" %}
    
    <div class="content-wrapper">
      {% block content %}{% endblock content %}
                </div>
                
    {% include "includes/footer.html" %}

                </div>
                
  {% else %}

  {% block auth_content %}{% endblock auth_content %}

  {% endif %}

  {% include "includes/scripts.html" %}
  {% include "includes/product_quick_view_modal.html" %}
  {% include "includes/quick_task_modal.html" %}
  {% include "includes/customer_modals.html" %}
  {% include "includes/all_modals.html" %}

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <script id="flash-messages-script" type="application/json">
        {{ messages|tojson|safe }}
      </script>
      <script>
        (function() {
          var scriptElement = document.getElementById('flash-messages-script');
          if (scriptElement) {
            try {
              var flashMessages = JSON.parse(scriptElement.textContent);
              flashMessages.forEach(function(msg) {
                var category = msg[0] || 'info';
                var message = msg[1] || '';
                
                // Mapper les catégories Flask vers Bootstrap
                var alertClass = 'alert-info';
                var iconClass = 'ni ni-bell-55';
                
                if (category === 'success') {
                  alertClass = 'alert-success';
                  iconClass = 'ni ni-check-bold';
                } else if (category === 'danger' || category === 'error') {
                  alertClass = 'alert-danger';
                  iconClass = 'ni ni-fat-remove';
                } else if (category === 'warning') {
                  alertClass = 'alert-warning';
                  iconClass = 'ni ni-notification-70';
                }
                
                // Créer et afficher l'alerte
                var alertDiv = document.createElement('div');
                alertDiv.className = 'alert ' + alertClass + ' alert-dismissible fade show';
                alertDiv.setAttribute('role', 'alert');
                alertDiv.style.position = 'fixed';
                alertDiv.style.top = '20px';
                alertDiv.style.right = '20px';
                alertDiv.style.zIndex = '9999';
                alertDiv.style.minWidth = '300px';
                alertDiv.style.maxWidth = '500px';
                
                alertDiv.innerHTML = '<span class="alert-inner--icon"><i class="' + iconClass + '"></i></span>' +
                  '<span class="alert-inner--text"><strong>' + message + '</strong></span>' +
                  '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                  '<span aria-hidden="true">&times;</span></button>';
                
                document.body.appendChild(alertDiv);
                
                // Auto-dismiss après 5 secondes
                setTimeout(function() {
                  if (alertDiv.parentNode) {
                    alertDiv.classList.remove('show');
                    setTimeout(function() {
                      if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                      }
                    }, 300);
                  }
                }, 5000);
              });
            } catch (e) {
              console.error('Erreur lors du parsing des messages flash:', e);
            }
          }
        })();
      </script>
    {% endif %}
  {% endwith %}

  <!-- Dark Mode Toggle -->
  <script>
    // Gestion du mode sombre
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const body = document.body;
    
    // Charger le thème sauvegardé
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
      body.classList.add('dark-mode');
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
    }
    
    // Toggle du thème
    if (themeToggle) {
      themeToggle.addEventListener('click', function(e) {
        e.preventDefault();
        
        body.classList.toggle('dark-mode');
        
        if (body.classList.contains('dark-mode')) {
          // Passage en mode sombre
          themeIcon.classList.remove('fa-moon');
          themeIcon.classList.add('fa-sun');
          localStorage.setItem('theme', 'dark');
        } else {
          // Passage en mode clair
          themeIcon.classList.remove('fa-sun');
          themeIcon.classList.add('fa-moon');
          localStorage.setItem('theme', 'light');
        }
      });
    }
  </script>

  <!-- Notifications Sonores Globales -->
  <script>
    // Fonction globale pour afficher une notification avec son
    function showNotification(message, type = 'info') {
        // Jouer le son correspondant au type de notification
        playNotificationSound(type);
        
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
            ${message}
            <button type="button" class="close" data-dismiss="alert">
                <span>&times;</span>
            </button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-suppression après 5 secondes
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }

    // Fonction pour jouer les sons de notification
    function playNotificationSound(type) {
        try {
            // Créer un contexte audio
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Fréquences et durées selon le type
            let frequency, duration;
            
            switch(type) {
                case 'success':
                    frequency = 800; // Son aigu et agréable
                    duration = 0.3;
                    break;
                case 'error':
                    frequency = 300; // Son grave et d'alerte
                    duration = 0.5;
                    break;
                case 'warning':
                    frequency = 600; // Son moyen
                    duration = 0.4;
                    break;
                default: // info
                    frequency = 500; // Son neutre
                    duration = 0.2;
                    break;
            }
            
            // Créer l'oscillateur
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            // Configuration du son
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            // Enveloppe du son (fade in/out)
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            // Jouer le son
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
            
        } catch (error) {
            // Fallback: utiliser l'API Web Audio simple
            console.log('Notification sonore:', type);
        }
    }
  </script>

  <!-- Specific JS goes HERE --> 
  {% block javascripts %}{% endblock javascripts %}

  <script src="/static/assets/js/argon.js?v=1.2.0"></script>

</body>

</html>
